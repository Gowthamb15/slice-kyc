<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>slice Corporate Portal</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
}

.header{
display:flex;
justify-content:space-between;
align-items:center;
padding:20px 40px;
background:rgba(0,0,0,0.4);
}

.brand{
font-size:38px;
font-weight:bold;
color:#ff2d9a;
}

.login-box{
width:420px;
margin:120px auto;
background:rgba(255,255,255,0.07);
padding:40px;
border-radius:15px;
backdrop-filter:blur(15px);
box-shadow:0 20px 60px rgba(0,0,0,0.6);
}

input,select,textarea{
width:100%;
padding:12px;
margin-bottom:15px;
border-radius:8px;
border:none;
}

button{
background:#ff2d9a;
color:white;
border:none;
padding:10px 18px;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}

button:hover{opacity:0.85;}

.main{padding:40px;}

.card{
background:rgba(255,255,255,0.06);
padding:20px;
border-radius:12px;
margin-bottom:20px;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:12px;
border-bottom:1px solid rgba(255,255,255,0.15);
text-align:center;
}

th{background:rgba(0,0,0,0.4);}

.progress-container{
width:100%;
background:#333;
border-radius:8px;
display:none;
margin-bottom:15px;
}

.progress-bar{
height:10px;
background:#ff2d9a;
width:0%;
border-radius:8px;
transition:0.3s;
}
</style>
</head>

<body>

<div id="loginPage" class="login-box">
<h2 style="text-align:center;color:#ff2d9a;font-size:42px;font-weight:bold;">slice</h2>

<select id="role">
<option value="agent">Agent</option>
<option value="admin">Admin</option>
</select>

<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">

<button onclick="login()">Login</button>
</div>

<div id="dashboard" style="display:none;">
<div class="header">
<div class="brand">slice</div>
<div>
<span id="welcome"></span>
<button onclick="logout()">Logout</button>
</div>
</div>

<div class="main">
<div id="portfolioArea"></div>
<div id="formArea"></div>
</div>
</div>

<script>

let records = JSON.parse(localStorage.getItem("sliceKYCData")) || [];
let currentUser="";
let currentRole="";

function saveData(){
localStorage.setItem("sliceKYCData",JSON.stringify(records));
}

function login(){
let role=document.getElementById("role").value;
let user=document.getElementById("username").value.trim();
let pass=document.getElementById("password").value.trim();

if(role==="admin"){
if(user==="admin" && pass==="admin123"){
currentUser="admin";
currentRole="admin";
}else{alert("Invalid Admin Login");return;}
}else{
if(user==="" || pass===""){alert("Enter username & password");return;}
currentUser=user;
currentRole="agent";
}

document.getElementById("loginPage").style.display="none";
document.getElementById("dashboard").style.display="block";
document.getElementById("welcome").innerText="Welcome, "+currentUser;

renderDashboard();
}

function logout(){location.reload();}

function renderDashboard(){

let portfolio=document.getElementById("portfolioArea");
let form=document.getElementById("formArea");

portfolio.innerHTML="";
form.innerHTML="";

let filtered=currentRole==="admin"?records:records.filter(r=>r.agent===currentUser);

let html='<div class="card"><h3>Portfolio</h3>';

if(filtered.length===0){
html+="<p>No Records Found</p>";
}else{
html+='<table><tr><th>Agent</th><th>Name</th><th>Phone</th><th>Date</th><th>Files</th></tr>';
filtered.forEach(r=>{
html+=`<tr>
<td>${r.agent}</td>
<td>${r.name}</td>
<td>${r.phone}</td>
<td>${r.date}</td>
<td>${r.files.length}</td>
</tr>`;
});
html+="</table>";
}
html+="</div>";

if(currentRole==="admin"){
html+=`<div class="card">
<button onclick="downloadAll()">Download All (ZIP + Excel)</button>
</div>`;
}

portfolio.innerHTML=html;

if(currentRole==="agent"){
form.innerHTML=`
<div class="card">
<h3>New KYC Submission</h3>
<input type="text" id="name" placeholder="Full Name">
<input type="text" id="phone" placeholder="Phone">
<textarea id="address" placeholder="Address"></textarea>

<label>Upload Attachments (Max 20)</label>
<input type="file" id="files" multiple>

<div class="progress-container" id="progressBox">
<div class="progress-bar" id="progressBar"></div>
</div>

<button onclick="submitKYC()">Submit</button>
</div>`;
}
}

function submitKYC(){

let files=document.getElementById("files").files;
if(files.length===0){alert("Upload files");return;}
if(files.length>20){alert("Max 20 files allowed");return;}

let progressBox=document.getElementById("progressBox");
let progressBar=document.getElementById("progressBar");
progressBox.style.display="block";
progressBar.style.width="0%";

let uploaded=0;
let fileData=[];
let promises=[];

for(let file of files){
promises.push(new Promise(resolve=>{
let reader=new FileReader();
reader.onload=function(){
fileData.push({
fileName:file.name,
fileBlob:file
});
uploaded++;
progressBar.style.width=Math.round((uploaded/files.length)*100)+"%";
resolve();
};
reader.readAsArrayBuffer(file);
}));
}

Promise.all(promises).then(()=>{
records.push({
agent:currentUser,
name:document.getElementById("name").value,
phone:document.getElementById("phone").value,
address:document.getElementById("address").value,
date:new Date().toLocaleDateString(),
files:fileData
});
saveData();
alert("Upload Completed");
renderDashboard();
});
}

function downloadAll(){

if(records.length===0){alert("No records");return;}

let zip=new JSZip();

/* Create Excel Data */
let excelData = records.map(r=>({
Agent:r.agent,
Name:r.name,
Phone:r.phone,
Address:r.address,
Date:r.date
}));

let ws = XLSX.utils.json_to_sheet(excelData);
let wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "KYC Data");
let excelBuffer = XLSX.write(wb,{bookType:'xlsx',type:'array'});

zip.file("KYC_Data.xlsx",excelBuffer);

/* Add Files */
records.forEach((r,i)=>{
let folder=zip.folder("Record_"+(i+1)+"_"+r.name);
r.files.forEach(f=>{
folder.file(f.fileName,f.fileBlob);
});
});

zip.generateAsync({type:"blob"}).then(content=>{
let link=document.createElement("a");
link.href=URL.createObjectURL(content);
link.download="slice_KYC_Data.zip";
link.click();
});
}

</script>
</body>
</html>